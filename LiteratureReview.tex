\chapter{Literature Review}
% -_____________________________________________________________________________

\section{Goals And Methodology}


% -_____________________________________________________________________________

\section{Blockchain Basics}




% -_____________________________________________________________________________

\subsection{How it works}





% -_____________________________________________________________________________

\subsection{Consensus in Blockchain Systems}
\url{https://vitalik.ca/general/2017/12/31/pos_faq.}
\url{https://vitalik.ca/general/2017/12/31/pos_faq.html#what-is-weak-subjectivity}


% -_____________________________________________________________________________

\subsection{Types Of Consensus}




% -_____________________________________________________________________________

\subsubsection{Proof-Of-Work}




% -_____________________________________________________________________________

\subsubsection{Proof-Of-Stake}





% -_____________________________________________________________________________

\subsection{Types Of Blockchains}



% -_____________________________________________________________________________

\subsubsection{Public Vs Private Vs Permissioned}


% -_____________________________________________________________________________

\section{Ethereum Basics}

***explain the whole of ethereum from an all inclusive perspective, inclusing like why gas exists, what it is, very simply. And teh Dapp ecosysm, and how eth is just a the bottom layer, why Eth exists basically.

***introduce what a blockchain is, basics

Many nodes that communicate over a network following the 'ETH' protocol, forming the Ethereum network. The nodes all contribute to maintaing and securing a globally agreed state of the Ethereum Virtual Machine (EVM). The security of the network comes from a majority of nodes agreeing on the new change to the state of this EVM. In other words, agreeing on the next blocks to be permanently added to the blockchain. They are paid in \textbf{ether (ETH)}, Ethereum's native cryptocurrency, to run this validator software to validate new blocks received over the peer-to-peer netowork.

***Introduce the need for consensus protocols

When a user wants to enter a transaction into the blockchain, they specify the transaction amount, the secure it with their private key and also specify the tip they are willing to pay on top of the base transaction fees (both in 'gas') to incentivise a validator to include their transaction in an upcoming block. The JSON RCP API takes this request to the ETH Execution Client. This client verifies the transaction request by checking things like whether the user has the enough money to complete this transaction and if they used the correct private key. \cite{EthereumEthereum.org} 

This is then broadcasted to every other validator over the execution layer 'gossip network'. Every validator adds this transaction to their local \textbf{mempool}. This is a collection of unverified transaction that are waiting to be processed and added to a block.

A validator is selected per slot pseudo-randomly. The validator chooses transactions out of its mempool to include in its block. It executes these transactions locally, causing a state change. Once it completes enough transaction to fill up a block (there is a gas limit per block), it proposes this signed 'beacon' block to all other validators over the consensus layer. This block is also wrapped in other information such as rewards, slashings, attestations, that enable the network to come to agree on the sequence of blocks at the head of the chain.

When other nodes receive this proposed block, they pass it to their execution layer client where they verify the data inside it. This includes ensuring it corresponds to the correct slot, correct parent etc. but most importantly, the transaction in the block are re-executed to check that the state change being proposed is valid. If the prosposed block passes these checks, the node adds it to its own 'canonical?' chain.  \cite{EthereumEthereum.org} 


\textbf{Sharding}
One solution to increasing the number of transactions throughput on the network is sharding. It refers to splitting the entire Ethereum network into 64 portions called \textbf{shards} cite ** ** **\url{https://github.com/ethereum/annotated-spec/blob/master/phase0/beacon-chain.md#attestationdata}. Each shard would contain its own independent state. It is an attempt at breaking up the blockchain into smaller parts no nodes are not responsible for processing or re-executing every single transaction broadcasted on the Ethereum network. Each shard is still connected to the main Ethereum chain cryptographically through merkle trees. \cite{EthereumEthereum.org} 


\textbf{Attestations}
Validators are expected to create, sign and then propagate their attestation to the rest of the network, every epoch.
Its purpose to vote for a specific slot of an epoch. The focus of this voting to retrieve each validator's view of the blockchain after each epoch. Meaning, their attestation in favour of their first and last block of the epoch are most important. This information is combined to help the network reach consensus about which block-chain to follow.



% -_____________________________________________________________________________
\subsection{Post-Merge Ethereum - "The Merge"/ "London Upgrade"/"Paris" idk}

\url{https://blog.ethereum.org/2021/05/18/country-power-no-more}

"The Merge" or "London Upgrade" happened in September 2022. The Ethereum Blockchain switched from the older Proof of Work to the Proof-of-Stake consensus protocol. The Beacon Chain (a test network) is being merged with the original Ethereum blockchain. Both will operate simultaneously in layers. The older Ethereum chain is now known as the 'execution' layer, and Ethereum is now secured by the Proof-Of-Stake 'consensus' layer (the Beacon Chain). 

This merging of the original chain with the Beacon Chain makes the need for miners redundant. \textbf{Validator nodes} now secure the Ethereum network. 

To participate in the validation of transactions on the Ethereum network, a node must put 32 ETH (equivalent to Â£45000 currently) at stake. These validator nodes will be responsible for storing data, processing transactions and adding new blocks to the Ethereum blockchain permanently. These are also called Full Nodes later in this paper.


 ****explain why client diversity is important
 **** once you have a node running, its not automatically a validator node
****reasons its good for the network if more poeple run a node, with which come energy consumption
 
\paragraph{Staking ETH :}
This can be done in many different ways as not everyone has access to 32 ETH to stake. To get past this high barrier of entry, validator nodes can be operated by solo staking, staking-as-a-service, pooled staking or centralised exchanges.

There are some risks involved with staking. Here are a few:
 ***shorten this section, kee relevant bits
\textbf{Slashing :}
This is when the algorithm destroys a portion of a validator's stake for behaving maliciously/ against the best interests of the network, introduced as a security feature. These penalties range from 0.5 ETH to the Entire 32 ETH, making it prohibitively expensive to attack Ethereum. 

\textbf{Offline Penalty :}
If a validator goes offline for a number of days, they incur losses roughly equivalent to what they would have gained had they remained online. This is not the same as slashing; instead, the node loses out on the ETH they would have gained during that time.

\textbf{Liquid ETH: }
People operating validator nodes must be prepared to lock up 32 ETH for an indefinite period. There are ways around this, however, through using 3rd parties. 
 % -------
\newline \newline
On the other hand, there are many incentives to run validator nodes. There is a popular mantra in blockchain, "Don't trust, verify" \cite{EthereumEthereum.org}. Following this altruistic mantra, running a node allows a user to interact with the Ethereum Network in a trustless and self-sufficient manner. Everything can be checked and verified with your own validator, removing the need to trust information from any other nodes in the network. 

Blocks are 'forged' by validators at a fixed tempo in PoS Ethereum. Every 12-second time \textbf{slot}, a randomly selected validator forges a block and sends it out to the network. 32 slots make up an \textbf{epoch}, usually around 6 minutes. For every slot, a random committee of nodes is also selected, whose votes determine whether the proposed block is valid or not. The algorithm judges each validator's actions and dishes out rewards and penalties at the end of each epoch accordindly. 


These include:

\textbf{Block Proposer Reward :}
****Cover the other type of reward. Make it shorter
This is for those validator nodes chosen randomly to validate the next round of transactions on the blockchain. Hence, they are responsible for proposing the next block. When their block is finalised, they are awarded a substantial amount of ETH.


'The Merge' has substituted Ethereum's security model's reliance on computational power to \textbf{economic power}, which are comparable in many ways. Malicious attackers will not need 51\% of the economic power of the entire Ethereum network instead of 51\% of the mining power. This helps with keeping the network decentralised in a secure manner while massively reducing the energy consumption of the network. 

\url{https://twitter.com/VitalikButerin/status/1260314647980322824}



% -_____________________________________________________________________________
\subsection{Ethereum Key Concepts}

\textbf{Full Nodes/Validator Nodes :}
Each validator node is responsible for one of the two:
\begin{enumerate}
    \item Propose a new block by executing pending transactions from the mempool when randomly chosen as a block proposer for a slot
    \item Check blocks other validator nodes are proposing and attest to them by checking their validity and voting 
\end{enumerate}
As explained before, these nodes must stake 32 ETH in order to participate in securing the Ethereum network and earn rewards for adding blocks to the blockchain.

It is periodically pruned so that it doesn't hold the entire history of the blockchain back to the genesis block. Apart from validating transactions and proposing blocks, it also provides data on request, for example, to light clients.

Apart from users looking to earn ETH or altruistic users wanting to secure the Ethereum network, not many users have the incentive to invest the time and resources to run a full node. This is why most users end up using centralised 3rd party hosted nodes. Client wallets like MetaMask and MyEtherWallet connect to a remote node in a non-cryptographically proven matter. 

As a result, new lighter nodes were introduced to help make Ethereum accessible to more users, which in turn also makes the network more secure.

\textbf{Light Nodes :}
These are nodes that don't stake Ethereum. Instead, they are just used for accessing the network along with storing and processing the validation of the blocks within the network. These rely on full nodes as intermediaries to receive up-to-date information about the state of the blockchain. In essence, they are spectator nodes that constantly monitor the network and are witnesses that all activity complies with the rules.

Because they are up-to-date nodes, they are allowed to interact with the Ethereum blockchain.  All they require is a simple installation of an ETH 2.0 node and a connection to the internet. This means the minimum requirements for the hardware required to run a light node is minimal and can be run on mobile devices.

By design, they don't need to store or process the same amount of information that full nodes do. PoW light nodes only used download the headers of each block and were able to trace back. PoS light nodes also has to keep track of validators and their balances to stay on the chain with the most stake. This small amount of information allows light nodes to operate in a trust-minimised manner.

\textbf{Archive Nodes:}
Maintain an exact and complete copy of the entire blockchain from the genesis block. 

In the context of a blockchain, a client is software that connects to other clients in a peer-to-peer manner. Due to this cross-communication, these clients form a network where each client acts as a node. 

\textbf{Execution Clients: }
Previously known as 'Eth 1' clients. These are community-maintained open-source execution layer clients. The goal is to ideally have a diverse share of clients being used to make the network stronger and reduce single points of failure.

Some popular execution layer clients include Geth, Nethermind, Besu and Erigon, written in languages such as Java, Go, and C\# \cite{EthereumEthereum.org}. 

\textbf{Consensus Clients: }
Following 'The Merge', many consensus clients, also known as 'Eth 2' clients, running the Beacon Chain provide the security layer to the Ethereum network. This is the layer responsible for running the PoS consensus mechanism.

Some popular consensus layer clients include Prysm, Lighthouse, Teku, Nimbus and Lodestar, written in languages 
 such as Rust, Nim, Typescript and Go \cite{EthereumEthereum.org}. 

The latest shares these consensus and execution layer clients take up on the network are shown in \tref{Table:tabsubex} in the Model Evaluation section \ref{Modelling} of this report.

\textbf{Syncing Methods:} \newline 
Synchronisation refers to a new node catching up with the rest of the Ethereum network and get the most up-to-date information. This is done by requesting, storing and verifying data from peers, cryptographically verifying their integrity and building a local copy of the blockchain.

PoS Ethereum relies on the consensus layer to handle the consensus logic and, more importantly, block propagation. So the synchronisation process is shared between both the EL and CL client. In order for the EL client to start verifying and syncing a local copy of the blockchain, the CL client has to download the block header. Only when the CL client provides the EL client with a header to use as a synching target can it cryptographically verify the chain of blocks they are syncing is valid. After this is complete, the blocks' information is downloaded \cite{2022DeveloperGo-ethereum}.

\textbf{Execution Layer Syncing: } 

Many syncing modes exist, such as full, snap, fast and light mode. The most commonly used modes are explained as follows: 

\textbf{Full Sync } independently verifies the block provenance by re-executing the transactions starting all the way form the genesis block. However, only the latest 128 blocks are actually stored in the full node along with a few checkpoints representing the older blocks. 

\textbf{Snap Sync}is an innovative approach developed by Geth developers(the prevailing EL client). It works like a full sync except it starts are a much more recent checkpoint to start its verification upto the head of the chain. It also stores the most recent 128 blocks, with a few checkpoints for the blocks before that \cite{2022DeveloperGo-ethereum}.


% -_____________________________________________________________________________



\section{Energy Consumption And Carbon Emissions of Blockchain Systems}



% -_____________________________________________________________________________

\subsection{Papers On Carbon Emissions of Blockchain Systems}


% -_____________________________________________________________________________

\subsection{Papers On Modelling Energy Usage Of Blockchain Systems}


% -_____________________________________________________________________________

\subsubsection{Experimental Papers}



% -_____________________________________________________________________________

\subsubsection{Mathematical Papers}




\textbf{The CCRI Merge Paper } \cite{CCRI:Network}

Assumptions this paper makes:
\begin{itemize}
    \item Assumes the syncing energy of each node will skew energy averages, so ignores node bootstrapping energy usage during the sync phase.
    
    \item They run many full nodes with different combinations of execution and consensus layer clients. However, they did not then proceed further and run a validator node due to the high economic barrier of entry (staking 32 ETH). They claim the energy usage of turning it into a validator would be negligible.
    
    \item Did not consider light nodes and archive nodes, presumably because of the assumption that their energy usage will be negligible as well as the lack of support of light nodes at the time.

    \item Type of power supply and mainboard was not mentioned. This is important to the estimation as power efficiencies cause more power to be drawn from the grid than the amount that is utilised by a computer.
\end{itemize}

% -_____________________________________________________________________________


% Quick intro on AVX operations, what is TDP and why that is the upper limit of CPU power consumption
AVX instructions enable the processor to perform multiple floating-point operations at the same time, resulting in faster computation and improved performance. \cite{Schuchart2016TheScale}

% ______________________________________________________________________________


\section{Key Points Covered}
